It seems that in certain circumstances the game was still not giving the treasure to the correct player. I have now fixed this problem. Many thanks to the people who reported this.
